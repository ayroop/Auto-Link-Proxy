# راهنمای نصب پلاگین Auto Proxy Links

## پیش‌نیازها

### سرور وردپرس
- وردپرس نسخه 5.0 یا بالاتر
- PHP نسخه 7.4 یا بالاتر
- MySQL نسخه 5.6 یا بالاتر

### سرور پروکسی
- سرور ایران با دامنه `sv5.filmkhabar.space` یا IP `45.12.143.141`
- فایل `proxy.php` نصب شده و قابل دسترس
- پشتیبانی از HTTPS

## مراحل نصب

### مرحله 1: آماده‌سازی فایل‌ها

1. فایل‌های پلاگین را از پوشه `wordpress-plugin/` کپی کنید
2. پوشه `auto-proxy-links` را در مسیر `wp-content/plugins/` قرار دهید
3. ساختار نهایی باید به شکل زیر باشد:

```
wp-content/plugins/auto-proxy-links/
├── auto-proxy-links.php
├── uninstall.php
├── admin/
│   └── admin-page.php
├── assets/
│   └── js/
│       └── auto-proxy-links.js
├── languages/
│   └── auto-proxy-links-fa_IR.po
├── README.md
└── install-guide.md
```

### مرحله 2: فعال‌سازی پلاگین

1. وارد پنل مدیریت وردپرس شوید
2. به بخش "پلاگین‌ها" بروید
3. پلاگین "Auto Proxy Links" را پیدا کنید
4. روی "فعال کردن" کلیک کنید

### مرحله 3: تنظیمات اولیه

1. به بخش "تنظیمات > Auto Proxy Links" بروید
2. تنظیمات عمومی را تکمیل کنید:
   - **دامنه پروکسی**: `sv5.filmkhabar.space`
   - **IP اختصاصی**: `45.12.143.141`
   - **استفاده از IP**: اختیاری
3. تنظیمات را ذخیره کنید

### مرحله 4: تست اتصال

1. به بخش "تست اتصال" بروید
2. روی دکمه "تست اتصال" کلیک کنید
3. از موفقیت‌آمیز بودن اتصال اطمینان حاصل کنید

## تنظیمات پیشرفته

### دامنه‌های مجاز
به طور پیش‌فرض فقط لینک‌های `sv1.cinetory.space` تبدیل می‌شوند. می‌توانید دامنه‌های دیگر اضافه کنید:

```
sv1.cinetory.space
example.com
another-domain.com
```

### پسوندهای مجاز
فقط فایل‌های با این پسوندها تبدیل می‌شوند:

```
mp4
avi
mkv
mov
wmv
flv
webm
m4v
ts
mts
m2ts
```

### محتوای قابل پردازش
انتخاد کنید کدام بخش‌های سایت پردازش شوند:
- ✅ پست‌ها (پیش‌فرض)
- ✅ صفحات (پیش‌فرض)
- ✅ ویجت‌ها (پیش‌فرض)
- ⚪ نظرات (اختیاری)

## نحوه استفاده

### تبدیل خودکار
پس از فعال‌سازی، تمام لینک‌های مستقیم در محتوای سایت به طور خودکار تبدیل می‌شوند.

### شورت‌کد دستی
برای لینک‌های دستی از شورت‌کد استفاده کنید:

```
[proxy_link url="https://sv1.cinetory.space/h2/movie/file.mp4" text="دانلود فیلم"]
```

### استفاده در کد PHP
```php
// تبدیل URL به پروکسی
$proxy_url = AutoProxyLinks::convertUrl($original_url);

// تست اتصال
AutoProxyLinks::testConnection(function($success, $message) {
    if ($success) {
        echo "اتصال موفق: " . $message;
    } else {
        echo "خطا: " . $message;
    }
});
```

## عیب‌یابی

### مشکلات رایج

#### 1. لینک‌ها تبدیل نمی‌شوند
**علت**: دامنه در لیست مجاز نیست
**راه‌حل**: دامنه را در تنظیمات "دامنه‌های مجاز" اضافه کنید

#### 2. خطای اتصال پروکسی
**علت**: سرور پروکسی در دسترس نیست
**راه‌حل**: 
- سرور پروکسی را بررسی کنید
- فایل `proxy.php` را چک کنید
- تنظیمات DNS را بررسی کنید

#### 3. عملکرد کند
**علت**: حالت دیباگ فعال است
**راه‌حل**: حالت دیباگ را در تنظیمات غیرفعال کنید

#### 4. خطای 404 در لینک‌های پروکسی
**علت**: فایل `proxy.php` در سرور پروکسی وجود ندارد
**راه‌حل**: فایل `proxy.php` را در روت سرور پروکسی آپلود کنید

### بررسی لاگ‌ها

#### لاگ‌های وردپرس
```bash
tail -f wp-content/debug.log
```

#### لاگ‌های سرور
```bash
tail -f /var/log/apache2/error.log
tail -f /var/log/nginx/error.log
```

## امنیت

### توصیه‌های امنیتی

1. **HTTPS**: حتماً از HTTPS برای سرور پروکسی استفاده کنید
2. **محدودیت دسترسی**: محدودیت‌های مناسب برای فایل `proxy.php` تنظیم کنید
3. **به‌روزرسانی**: پلاگین و وردپرس را به‌روز نگه دارید
4. **فایروال**: قوانین فایروال مناسب تنظیم کنید

### فایل .htaccess برای سرور پروکسی
```apache
# محدودیت دسترسی
<Files "proxy.php">
    Order Allow,Deny
    Allow from all
</Files>

# محدودیت اندازه فایل
php_value upload_max_filesize 10G
php_value post_max_size 10G
php_value memory_limit 512M
php_value max_execution_time 300
php_value max_input_time 300

# امنیت
ServerTokens Prod
ServerSignature Off
```

## پشتیبانی

### تماس با پشتیبانی
- **ایمیل**: support@filmkhabar.space
- **وب‌سایت**: https://filmkhabar.space
- **تلگرام**: @filmkhabar_support

### اطلاعات مورد نیاز برای پشتیبانی
- نسخه وردپرس
- نسخه PHP
- نسخه پلاگین
- پیام خطا (در صورت وجود)
- لاگ‌های مربوطه

## به‌روزرسانی

### به‌روزرسانی خودکار
پلاگین از سیستم به‌روزرسانی خودکار وردپرس پشتیبانی می‌کند.

### به‌روزرسانی دستی
1. فایل‌های جدید را جایگزین کنید
2. تنظیمات را بررسی کنید
3. تست اتصال را انجام دهید

## حذف پلاگین

### حذف کامل
1. پلاگین را غیرفعال کنید
2. پلاگین را حذف کنید
3. فایل‌های باقی‌مانده را پاک کنید

### پاک‌سازی خودکار
فایل `uninstall.php` به طور خودکار تمام داده‌های پلاگین را پاک می‌کند. 